<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Choose your Class</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-neutral-800 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold text-white mb-6">Choose your Class</h1>

      <div class="flex gap-4 mb-6">
        <a
          href="/me.html"
          class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          >My Class Bookings
        </a>
        <form method="POST" action="/logout">
          <button
            type="submit"
            class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
          >
            Log out
          </button>
        </form>
      </div>
      <!--ตาราง Class-->
      <div id="trainers" class="flex flex-col gap-6"></div>

      <p class="mt-6" id="admin-link" style="display: none">
        <a href="/admin" class="text-blue-500 hover:underline">Admin</a>
      </p>
    </div>

    <script>
      let TRAINERS = [];

      async function loadTrainers() {
        try {
          const response = await fetch("/api/trainers");
          TRAINERS = await response.json();
          renderTrainers();
        } catch (err) {
          console.error("Failed to load trainers:", err);
        }
      }

      function thb(n) {
        return "฿" + Number(n).toLocaleString();
      }

      function renderTrainers() {
        const root = document.getElementById("trainers");
        if (!root) return;
        root.innerHTML = "";

        TRAINERS.forEach((t, i) => {
          const card = document.createElement("div");
          card.className = "bg-neutral-100 p-6 rounded-lg shadow-md";

          card.innerHTML = `
          <p class="text-gray-1200 mb-6">
        <span class="font-bold text-xl">${t.class}</span>
       <span class="text-green-800">${thb(t.price)}</span>
   </p>
  <!--เอาชื่อเทรนเนอร์ออก-->
        <div class="flex flex-wrap gap-2 mb-4">
        
          <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">${
            t.level
          }</span>
          <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">${
            t.length
          }</span>
          <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">Group: ${
            t.group_size
          }</span>
        </div>
 
        <p class="text-gray-600 mb-4">${t.about}</p>
<!--ย้ายราคา-->
        <details class="mb-4">
          <summary class="cursor-pointer text-blue-500 hover:underline">View class syllabus & schedule</summary>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
            <div>
              <b>What you'll learn</b>
              <ul class="list-disc list-inside text-gray-600">
                ${t.syllabus.map((li) => `<li>${li}</li>`).join("")}
              </ul>
            </div>
            <div>
<!--แก้ลบตารางเวลาตรงview class-->
            </div>
          </div>
        </details>
<!--ปุ่ม Book ฟ้า แก้-->
        <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 book-btn" data-idx="${i}">Book </button>
      `;
          root.appendChild(card);
        });
        //Book Class
        root.addEventListener("click", (e) => {
          const btn = e.target.closest(".book-btn");
          if (!btn) return;
          const t = TRAINERS[btn.dataset.idx];
          const url = `/booking.html?trainer=${encodeURIComponent(
            t.name,
          )}&trainerId=${t.id}&class=${encodeURIComponent(t.class)}&classId=${
            t.classId
          }&price=${t.price}`;
          location.href = url;
        });
      }

      async function checkAdmin() {
        try {
          const response = await fetch("/api/me");
          if (response.status === 401) {
            window.location.href = "/login.html";
            return;
          }
          if (response.ok) {
            const user = await response.json();
            if (user.role === "admin") {
              document.getElementById("admin-link").style.display = "block";
            }
          }
        } catch (err) {
          console.error("Failed to check user role:", err);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadTrainers();
        checkAdmin();
      });
    </script>
  </body>
</html>
